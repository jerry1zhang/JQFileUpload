!function(e){e.extend({_uploadFile:function(r){if(r&&r.file&&r.file instanceof File){r.progress&&"function"!=typeof r.progress&&delete r.progress,r.end&&"function"!=typeof r.end&&delete r.end,r.error&&"function"!=typeof r.error&&delete r.error,r=e.extend({timeout:5e3,type:"POST",dataType:"json"},r);var o=new FormData;o.append("upload",r.file),e.ajax({url:r.url,type:r.type,cache:"false",dataType:r.dataType,processData:!1,contentType:!1,timeout:r.timeout,data:o,xhr:function(){var o=e.ajaxSettings.xhr();return r.progress&&(o.upload.onprogress=function(e){e.lengthComputable&&r.progress(e.loaded/e.total*100)}),o},success:function(e){r.end&&r.end(e)},error:function(e){r.error&&r.error(e)}})}},_loadLocalImg:function(e){if(e&&e.file&&e.file instanceof File){if({"image/png":!0,"image/jpeg":!0,"image/gif":!0}[e.file.type]){var r=new FileReader;e.imgpreviewprogress&&"function"==typeof e.imgpreviewprogress&&(r.onprogress=function(r){r.lengthComputable&&e.imgpreviewprogress(r.loaded/r.total*100)}),e.previewload&&"function"==typeof e.previewload&&(r.onload=function(r){e.previewload(r.target.result)}),r.readAsDataURL(e.file)}}}}),e.fn.extend({fileUpload:function(r){var o=null,t=null,n=null;if(r.previewId)if(n=e("#"+r.previewId),n.length){var a=r.previewload;r.previewload=function(e){n.attr("src",e),a&&a(e)}}else preview=null;return r.accept=r.accept||"",this.each(function(){var n=e('<input type ="file" style="display:none" accept="'+r.accept+'"/>');if(e(this).after(n),e(this).click(function(){n.click()}),n.change(function(n){if(o=n.target.files,o.length){if(r.file=o[0],r.before&&"function"==typeof r.before&&!(t=r.before(r.file))&&void 0!==t)return;preview&&e._loadLocalImg(r),r.autoUpload&&e._uploadFile(r)}}),r.dragable||r.dragAreaId){var a=e(r.dragAreaId?"#"+r.dragAreaId:this);a.on("dragover",function(r){return e(this).addClass("dragOver"),!1}),a.on("dragleave",function(r){return e(this).removeClass("dragOver"),!1}),a.on("drop",function(n){if(e(this).removeClass("dragOver"),n.originalEvent.dataTransfer&&(o=n.originalEvent.dataTransfer.files),o.length){if(r.file=o[0],r.before&&"function"==typeof r.before&&!(t=r.before(r.file))&&void 0!==t)return;preview&&e._loadLocalImg(r),r.autoUpload&&e._uploadFile(r)}return!1})}!r.autoUpload&&r.uploadBtn&&e("#"+r.uploadBtn).length&&e(r.uploadBtn).click(function(){e._uploadFile(r)})})}})}(window.jQuery);